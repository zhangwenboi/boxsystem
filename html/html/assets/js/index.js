import{j as e,P as R,a as F,b as B,c as f,S as h,d as S,M as I,W as w,e as L,f as b,g as O,h as M}from"./ant-design-pro-components.js";import{az as z,r as u,C as N,s as A,B as C,V as l,aC as E,j as _}from"./antd.js";import{l as H,m as $,n as D}from"./icons.js";import{O as k,f as q,g as j,a as G}from"./react-router.js";import{L as V,H as W}from"./react-router-dom.js";import{e as Y}from"./umi-request.js";import{_ as K}from"./react-countup.js";import{L as U}from"./ant-charts.js";(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))n(t);new MutationObserver(t=>{for(const a of t)if(a.type==="childList")for(const i of a.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&n(i)}).observe(document,{childList:!0,subtree:!0});function o(t){const a={};return t.integrity&&(a.integrity=t.integrity),t.referrerPolicy&&(a.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?a.credentials="include":t.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function n(t){if(t.ep)return;t.ep=!0;const a=o(t);fetch(t.href,a)}})();var g={},P=z;g.createRoot=P.createRoot,g.hydrateRoot=P.hydrateRoot;const J={route:{path:"/",routes:[{path:"/home",name:"欢迎",icon:e.jsx(H,{}),component:"./home"}]},location:{pathname:"/"}},Q=()=>{const[s,r]=u.useState("/home");return typeof document>"u"?e.jsx("div",{}):e.jsx("div",{id:"test-pro-layout",style:{height:"100vh",overflow:"auto"},children:e.jsx(R,{hashed:!1,children:e.jsx(N,{getTargetContainer:()=>document.getElementById("test-pro-layout")||document.body,children:e.jsx(F,{prefixCls:"my-prefix",...J,location:{pathname:s},token:{header:{colorBgMenuItemSelected:"rgba(0,0,0,0.04)"}},siderMenuType:"group",menu:{collapsedShowGroupTitle:!0},title:"系统信息",menuItemRender:(o,n)=>e.jsx("div",{onClick:()=>{r(o.path||"/home")},children:n}),children:e.jsx(B,{token:{paddingInlinePageContainerContent:20},subTitle:"下行盒子拉取查看",children:e.jsx(k,{})})})})})})},X=()=>e.jsx(A,{status:"404",title:"404",subTitle:"哦吼,找不到页面了!",extra:e.jsx(V,{to:"/",children:e.jsx(C,{type:"primary",children:"返回首页"})})}),Z={200:"服务器成功返回请求的数据。",201:"新建或修改数据成功。",202:"一个请求已经进入后台排队（异步任务）。",204:"删除数据成功。",400:"发出的请求有错误，服务器没有进行新建或修改数据的操作。",401:"用户没有权限（令牌、用户名、密码错误）。",403:"用户得到授权，但是访问是被禁止的。",404:"发出的请求针对的是不存在的记录，服务器没有进行操作。",406:"请求的格式不可得。",410:"请求的资源被永久删除，且不会再得到的。",422:"当创建一个对象时，发生一个验证错误。",500:"服务器发生错误，请检查服务器。",502:"网关错误。",503:"服务不可用，服务器暂时过载或维护。",504:"网关超时。"},ee=s=>{if(s.request.options.responseType==="blob")return s;const{response:r}=s;if(r&&r.status){const o=Z[r.status]||r.statusText,{status:n,url:t}=r;let a=t;t.indexOf("?")!==-1&&(a=t.substring(0,t.indexOf("?"))),n!==502&&l.error(`请求错误 [${n}]: ${a}${o}`)}else r||l.error("您的网络发生异常，无法连接服务器");return r},m=Y({errorHandler:ee,credentials:"include"});m.interceptors.response.use(async(s,r)=>{if(r.responseType==="blob")return s;const{status:o}=s;return o===500&&l.error({content:"网络错误"}),s});const te=async s=>await new Promise(r=>{setTimeout(()=>{r(!0)},s)}),re=({width:s})=>e.jsxs(I,{title:"设置模式",layout:"horizontal",modalProps:{destroyOnClose:!0},labelCol:{span:8},request:async()=>{var o,n,t;const r=await m.get("/api/conf_info/");if(r.code===1e3){const a=(o=r.data)!=null&&o.time?(t=((n=r.data)==null?void 0:n.time).split(","))==null?void 0:t.map(i=>({time:i==null?void 0:i.split("_")})):[{time:["00:00","23:59"]}];return(a==null?void 0:a.length)>0?{...r.data,timers:a}:r.data}return null},width:s,trigger:e.jsx("a",{className:"mx-2",children:" 系统设置 "}),onFinish:async r=>{var t,a,i;const o=r;return((t=o.timers)==null?void 0:t.length)>0&&(o.time=(i=(a=o.timers)==null?void 0:a.map(d=>{var x;return(x=d==null?void 0:d.time.map(p=>p.length>=8?p:p+":00"))==null?void 0:x.join("_")}))==null?void 0:i.join(",")),(await m.post("/api/update_conf/",{data:o})).code===1e3?(l.loading("修改成功, 正在重启中！稍后将自动刷新刷新页面，如10秒后未自动刷新请手动进行刷新",-1),setTimeout(()=>{m.get("/api/network_speed").then(d=>{d.code===1e3&&setTimeout(()=>{window.location.reload()},4e3),l.destroy()})},1e3),!0):(l.error("修改失败，请稍后再试"),!1)},submitter:{render(r,o){return e.jsxs("div",{className:" flex gap-x-2 justify-center w-full ",children:[e.jsx(C,{danger:!0,onClick:async()=>(await m.post("/api/update_conf/",{data:{}})).code===1e3?(l.loading("修改成功, 正在重启中！稍后将自动刷新刷新页面，如10秒后未自动刷新请手动进行刷新",-1),setTimeout(()=>{m.get("/api/network_speed").then(t=>{t.code===1e3&&setTimeout(()=>{window.location.reload()},4e3),l.destroy()})},1e3),!0):(l.error("修改失败，请稍后再试"),!1),children:"恢复出厂设置"}),o]})}},children:[e.jsx(w,{name:"video_type",label:"下行流量类型",tooltip:"下行基本都是省外业务，只是业务不同",allowClear:!1,options:[{label:"抖音快手视频",value:"data"},{label:"抖音直播",value:"dlive"},{label:"快手直播",value:"klive"}],width:"md"}),e.jsx(L,{name:["video_type"],children:({video_type:r},o)=>{const n=r==="data",t=o.getFieldValue("video_thread"),a=new Array(n?10:20).fill(0).map((i,d)=>({label:d+1+" 个线程",value:d+1}));return n&&t>a.length&&o.setFieldsValue({video_thread:a.length}),e.jsx(w,{name:"video_thread",allowClear:!1,label:`${n?"同时下载线程":"同时直播线程"}`,tooltip:"同时进行几个下载，越多越快",width:"md",options:a})}}),e.jsx(b,{name:"max_flow",label:"当天最大流量",tooltip:"当天下载的最大流量(GB)",allowClear:!1,fieldProps:{addonAfter:"GB/天"},width:"md"}),e.jsx(b,{name:"max_mb",label:"线程最大速度",allowClear:!1,fieldProps:{addonAfter:"MB/秒"},tooltip:"每个线程下载时的最大速度(MB/s)",width:"md"}),e.jsx(O,{name:"timers",label:"运行时间",actionRender:(r,o,n)=>[n,e.jsx($,{onClick:()=>{var t;return(t=o==null?void 0:o.add)==null?void 0:t.call(o)},className:"mx-2 active:text-blue-400 hover:text-blue-400"})],creatorButtonProps:!1,copyIconProps:!1,deleteIconProps:{Icon:D,tooltipText:"删除此时间段"},children:e.jsx(M.RangePicker,{allowClear:!1,fieldProps:{format:"HH:mm",needConfirm:!1},width:"sm",name:"time"})})]}),se=s=>{if(s){const r=(s==null?void 0:s.split(/\ /g))||[0,"KB"];return e.jsx(K,{end:r[0],suffix:r[1],separator:",",decimals:2})}return"0KB"},oe=()=>{var y;const[s,r]=u.useState(),[o,n]=u.useState(1920),[t,a]=u.useState([]),i=async()=>{const c=await m.get("/api/system_status");c.code===1e3&&r(c.data)};u.useEffect(()=>{i()},[]);const d=(y=t==null?void 0:t[0])==null?void 0:y.rx,x=[{title:"日期",dataIndex:"day"},{title:"下载",dataIndex:"rx"},{title:"平均速率",tooltip:"下载速率统计可能不准确，仅供参考",dataIndex:"avg"}],p=t==null?void 0:t.reduce((c,T)=>{var v;return c+Number((v=T.rx.match(/\d+\.\d+/g))==null?void 0:v[0])},0);return e.jsx("div",{children:e.jsx(E,{onResize:c=>{n(c.width)},children:e.jsxs(f,{title:"数据概览",extra:e.jsxs(e.Fragment,{children:[e.jsx(re,{width:o>1e3?800:"md"}),o>1280&&_().format("YYYY-MM-DD HH:mm:ss")]}),split:o<1280?"horizontal":"vertical",headerBordered:!0,bordered:!0,children:[e.jsxs(f,{split:"horizontal",children:[e.jsxs(f,{split:"horizontal",children:[e.jsxs(f,{split:o<596?"horizontal":"vertical",children:[e.jsx(h,{statistic:{title:"今日下载",value:d,precision:3,formatter:se}}),e.jsx(h,{statistic:{title:"近30日流量",value:p,suffix:"GB",precision:2}})]}),e.jsxs(f,{split:"vertical",children:[e.jsx(h,{statistic:{title:"内存占用",value:(s==null?void 0:s.memory_used_percent)||0,precision:2,suffix:"%"}}),e.jsx(h,{statistic:{title:"CPU占用",value:`${(s==null?void 0:s.cpu_percent)||0}`,suffix:"%",precision:2}})]})]}),e.jsx(S,{headerTitle:"近30日流量",options:o<596?!1:{density:!0,fullScreen:!0,reload:!0},tooltip:"数据更新有延迟，仅供参考",request:async()=>{const c=await m.get("/api/month_info");return c.code===1e3?(a(c.data),{data:c.data,success:!0}):{data:[],success:!1}},search:!1,columns:x,pagination:{hideOnSinglePage:!0,defaultPageSize:7}})]}),e.jsx(h,{title:"流量走势",extra:!1,chart:e.jsx(ae,{})})]})},"resize-observer")})},ae=()=>{const[s,r]=u.useState([]);u.useEffect(()=>{const n=async()=>{const t=await m.get("/api/network_speed");t.code===1e3&&(r(a=>[...a,{label:_().format("HH:mm:ss"),value:Number(t.data)}]),await te(2e3),n())};n()},[]);const o={data:s||[],xField:"label",yField:"value",yAxis:{label:{formatter:n=>`${n}MB`}},tooltip:{title:"下载速度",formatter:n=>({name:n.label,value:n.value})},color:["#1979C9","#D62A0D","#FAA219"],smooth:!0,animation:!1};return e.jsx(U,{...o})};function ne({to:s}){let r=G();return u.useEffect(()=>{r(s)}),null}const ie=s=>e.jsx(u.Suspense,{children:s});function le(){return u.useEffect(()=>{var s;(s=document.querySelector("#index-loading"))==null||s.remove()},[]),e.jsx(q,{children:e.jsxs(j,{path:"/",element:e.jsx(Q,{}),children:[e.jsx(j,{path:"NotFound",element:e.jsx(X,{})}),e.jsx(j,{index:!0,element:ie(e.jsx(oe,{}))}),e.jsx(j,{path:"*",element:e.jsx(ne,{to:"NotFound"})})]})})}l.config({maxCount:1});l.destroy();g.createRoot(document.getElementById("root")).render(e.jsx(W,{children:e.jsx(le,{})}));
