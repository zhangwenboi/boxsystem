import{j as e,P as _,a as T,b as F,c as m,S as p,d as B,M as S,W as v,e as I,f as b,g as L,h as O}from"./ant-design-pro-components.js";import{az as M,r as c,C as z,s as N,B as A,V as f,aC as E,j as w}from"./antd.js";import{l as H,m as $,n as D}from"./icons.js";import{O as q,f as k,g as h,a as G}from"./react-router.js";import{L as V,H as W}from"./react-router-dom.js";import{e as Y}from"./umi-request.js";import{_ as K}from"./react-countup.js";import{L as U}from"./ant-charts.js";(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))n(t);new MutationObserver(t=>{for(const a of t)if(a.type==="childList")for(const i of a.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&n(i)}).observe(document,{childList:!0,subtree:!0});function o(t){const a={};return t.integrity&&(a.integrity=t.integrity),t.referrerPolicy&&(a.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?a.credentials="include":t.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function n(t){if(t.ep)return;t.ep=!0;const a=o(t);fetch(t.href,a)}})();var j={},P=M;j.createRoot=P.createRoot,j.hydrateRoot=P.hydrateRoot;const J={route:{path:"/",routes:[{path:"/home",name:"欢迎",icon:e.jsx(H,{}),component:"./home"}]},location:{pathname:"/"}},Q=()=>{const[s,r]=c.useState("/home");return typeof document>"u"?e.jsx("div",{}):e.jsx("div",{id:"test-pro-layout",style:{height:"100vh",overflow:"auto"},children:e.jsx(_,{hashed:!1,children:e.jsx(z,{getTargetContainer:()=>document.getElementById("test-pro-layout")||document.body,children:e.jsx(T,{prefixCls:"my-prefix",...J,location:{pathname:s},token:{header:{colorBgMenuItemSelected:"rgba(0,0,0,0.04)"}},siderMenuType:"group",menu:{collapsedShowGroupTitle:!0},title:"系统信息",menuItemRender:(o,n)=>e.jsx("div",{onClick:()=>{r(o.path||"/home")},children:n}),children:e.jsx(F,{token:{paddingInlinePageContainerContent:20},subTitle:"下行盒子拉取查看",children:e.jsx(q,{})})})})})})},X=()=>e.jsx(N,{status:"404",title:"404",subTitle:"哦吼,找不到页面了!",extra:e.jsx(V,{to:"/",children:e.jsx(A,{type:"primary",children:"返回首页"})})}),Z={200:"服务器成功返回请求的数据。",201:"新建或修改数据成功。",202:"一个请求已经进入后台排队（异步任务）。",204:"删除数据成功。",400:"发出的请求有错误，服务器没有进行新建或修改数据的操作。",401:"用户没有权限（令牌、用户名、密码错误）。",403:"用户得到授权，但是访问是被禁止的。",404:"发出的请求针对的是不存在的记录，服务器没有进行操作。",406:"请求的格式不可得。",410:"请求的资源被永久删除，且不会再得到的。",422:"当创建一个对象时，发生一个验证错误。",500:"服务器发生错误，请检查服务器。",502:"网关错误。",503:"服务不可用，服务器暂时过载或维护。",504:"网关超时。"},ee=s=>{if(s.request.options.responseType==="blob")return s;const{response:r}=s;if(r&&r.status){const o=Z[r.status]||r.statusText,{status:n,url:t}=r;let a=t;t.indexOf("?")!==-1&&(a=t.substring(0,t.indexOf("?"))),f.error(`请求错误 [${n}]: ${a}${o}`)}else r||f.error("您的网络发生异常，无法连接服务器");return r},u=Y({errorHandler:ee,credentials:"include"});u.interceptors.response.use(async(s,r)=>{if(r.responseType==="blob")return s;const{status:o}=s;return o===500&&f.error({content:"网络错误"}),s});const te=async s=>await new Promise(r=>{setTimeout(()=>{r(!0)},s)}),re=({width:s})=>e.jsxs(S,{title:"设置模式",layout:"horizontal",modalProps:{destroyOnClose:!0},labelCol:{span:8},request:async()=>{var o,n,t,a;const r=await u.get("/api/conf_info/");if(r.code===1e3){const i=(o=r.data)!=null&&o.time?(a=(t=(n=r.data)==null?void 0:n.time)==null?void 0:t.split(","))==null?void 0:a.map(l=>({time:l==null?void 0:l.split("_")})):[{time:["00:00","24:00"]}];return(i==null?void 0:i.length)>0?{...r.data,timers:i}:r.data}return null},width:s,trigger:e.jsx("a",{className:"mx-2",children:" 系统设置 "}),onFinish:async r=>{var t,a,i;const o=r;return((t=o.timers)==null?void 0:t.length)>0&&(o.time=(i=(a=o.timers)==null?void 0:a.map(l=>{var x;return(x=l==null?void 0:l.time)==null?void 0:x.join("_")}))==null?void 0:i.join(",")),(await u.post("/api/update_conf/",{data:o})).code===1e3?(f.success("修改成功, 稍后生效！"),!0):(f.error("修改失败，请稍后再试"),!1)},submitter:{render(r,o){return e.jsx("div",{className:" flex gap-x-2 justify-center w-full ",children:o})}},children:[e.jsx(v,{name:"video_type",label:"下行流量类型",tooltip:"下行基本都是省外业务，只是业务不同",allowClear:!1,options:[{label:"抖音快手视频",value:"data"},{label:"抖音直播",value:"dlive"},{label:"快手直播",value:"klive"}],width:"md"}),e.jsx(I,{name:["video_type"],children:({video_type:r},o)=>{const n=r==="data",t=o.getFieldValue("video_thread"),a=new Array(n?10:20).fill(0).map((i,l)=>({label:l+1+" 个线程",value:l+1}));return console.log(t),n&&t>a.length&&o.setFieldsValue({video_thread:a.length}),e.jsx(v,{name:"video_thread",allowClear:!1,label:`${n?"同时下载线程":"同时直播线程"}`,tooltip:"同时进行几个下载，越多越快",width:"md",options:a})}}),e.jsx(b,{name:"max_flow",label:"当天最大流量",tooltip:"当天下载的最大流量(GB)",allowClear:!1,fieldProps:{addonAfter:"GB/天"},width:"md"}),e.jsx(b,{name:"max_mb",label:"线程最大速度",allowClear:!1,fieldProps:{addonAfter:"MB/秒"},tooltip:"每个线程下载时的最大速度(MB/s)",width:"md"}),e.jsx(L,{name:"timers",label:"运行时间",actionRender:(r,o,n)=>[n,e.jsx($,{onClick:()=>{var t;return(t=o==null?void 0:o.add)==null?void 0:t.call(o)},className:"mx-2 active:text-blue-400 hover:text-blue-400"})],creatorButtonProps:!1,copyIconProps:!1,deleteIconProps:{Icon:D,tooltipText:"删除此时间段"},children:e.jsx(O.RangePicker,{allowClear:!1,fieldProps:{format:"HH:mm",needConfirm:!1},width:"md",name:"time"})})]}),se=s=>{if(s){const r=(s==null?void 0:s.split(/\ /g))||[0,"KB"];return e.jsx(K,{end:r[0],suffix:r[1],separator:",",decimals:2})}return"0KB"},oe=()=>{var g;const[s,r]=c.useState(),[o,n]=c.useState(1920),[t,a]=c.useState([]),i=async()=>{const d=await u.get("/api/system_status");d.code===1e3&&r(d.data)};c.useEffect(()=>{i()},[]);const l=(g=t==null?void 0:t[0])==null?void 0:g.rx,x=[{title:"日期",dataIndex:"day"},{title:"下载",dataIndex:"rx"},{title:"平均速率",tooltip:"下载速率统计可能不准确，仅供参考",dataIndex:"avg"}],C=t==null?void 0:t.reduce((d,R)=>{var y;return d+Number((y=R.rx.match(/\d+\.\d+/g))==null?void 0:y[0])},0);return e.jsx("div",{children:e.jsx(E,{onResize:d=>{n(d.width)},children:e.jsxs(m,{title:"数据概览",extra:e.jsxs(e.Fragment,{children:[e.jsx(re,{width:o>1e3?800:"md"}),o>1280&&w().format("YYYY-MM-DD HH:mm:ss")]}),split:o<1280?"horizontal":"vertical",headerBordered:!0,bordered:!0,children:[e.jsxs(m,{split:"horizontal",children:[e.jsxs(m,{split:"horizontal",children:[e.jsxs(m,{split:o<596?"horizontal":"vertical",children:[e.jsx(p,{statistic:{title:"今日下载",value:l,precision:3,formatter:se}}),e.jsx(p,{statistic:{title:"近30日流量",value:C,suffix:"GB",precision:2}})]}),e.jsxs(m,{split:"vertical",children:[e.jsx(p,{statistic:{title:"内存占用",value:(s==null?void 0:s.memory_used_percent)||0,precision:2,suffix:"%"}}),e.jsx(p,{statistic:{title:"CPU占用",value:`${(s==null?void 0:s.cpu_percent)||0}`,suffix:"%",precision:2}})]})]}),e.jsx(B,{headerTitle:"近30日流量",options:o<596?!1:{density:!0,fullScreen:!0,reload:!0},tooltip:"数据更新有延迟，仅供参考",request:async()=>{const d=await u.get("/api/month_info");return d.code===1e3?(a(d.data),{data:d.data,success:!0}):{data:[],success:!1}},search:!1,columns:x,pagination:{hideOnSinglePage:!0,defaultPageSize:7}})]}),e.jsx(p,{title:"流量走势",extra:!1,chart:e.jsx(ae,{})})]})},"resize-observer")})},ae=()=>{const[s,r]=c.useState([]);c.useEffect(()=>{const n=async()=>{const t=await u.get("/api/network_speed");t.code===1e3&&(r(a=>[...a,{label:w().format("HH:mm:ss"),value:Number(t.data)}]),await te(2e3),n())};n()},[]);const o={data:s||[],xField:"label",yField:"value",yAxis:{label:{formatter:n=>`${n}MB`}},tooltip:{title:"下载速度",formatter:n=>({name:n.label,value:n.value})},color:["#1979C9","#D62A0D","#FAA219"],smooth:!0,animation:!1};return e.jsx(U,{...o})};function ne({to:s}){let r=G();return c.useEffect(()=>{r(s)}),null}const ie=s=>e.jsx(c.Suspense,{children:s});function le(){return c.useEffect(()=>{var s;(s=document.querySelector("#index-loading"))==null||s.remove()},[]),e.jsx(k,{children:e.jsxs(h,{path:"/",element:e.jsx(Q,{}),children:[e.jsx(h,{path:"NotFound",element:e.jsx(X,{})}),e.jsx(h,{index:!0,element:ie(e.jsx(oe,{}))}),e.jsx(h,{path:"*",element:e.jsx(ne,{to:"NotFound"})})]})})}j.createRoot(document.getElementById("root")).render(e.jsx(W,{children:e.jsx(le,{})}));
