import{j as e,P as R,a as T,b as w,c as u,S as d,d as L}from"./ant-design-pro-components.js";import{az as O,r as l,C as S,s as B,B as E,V as p,aC as z,j as y}from"./antd.js";import{l as H}from"./icons.js";import{O as I,f as M,g as f,a as N}from"./react-router.js";import{L as _,H as A}from"./react-router-dom.js";import{e as D}from"./umi-request.js";import{_ as F}from"./react-countup.js";import{L as $}from"./ant-charts.js";(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const c of o.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&n(c)}).observe(document,{childList:!0,subtree:!0});function a(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(s){if(s.ep)return;s.ep=!0;const o=a(s);fetch(s.href,o)}})();var x={},g=O;x.createRoot=g.createRoot,x.hydrateRoot=g.hydrateRoot;const q={route:{path:"/",routes:[{path:"/home",name:"欢迎",icon:e.jsx(H,{}),component:"./home"}]},location:{pathname:"/"}},Y=()=>{const[t,r]=l.useState("/home");return typeof document>"u"?e.jsx("div",{}):e.jsx("div",{id:"test-pro-layout",style:{height:"100vh",overflow:"auto"},children:e.jsx(R,{hashed:!1,children:e.jsx(S,{getTargetContainer:()=>document.getElementById("test-pro-layout")||document.body,children:e.jsx(T,{prefixCls:"my-prefix",...q,location:{pathname:t},token:{header:{colorBgMenuItemSelected:"rgba(0,0,0,0.04)"}},siderMenuType:"group",menu:{collapsedShowGroupTitle:!0},title:"系统信息",menuItemRender:(a,n)=>e.jsx("div",{onClick:()=>{r(a.path||"/home")},children:n}),children:e.jsx(w,{token:{paddingInlinePageContainerContent:20},subTitle:"下行盒子拉取查看",children:e.jsx(I,{})})})})})})},K=()=>e.jsx(B,{status:"404",title:"404",subTitle:"哦吼,找不到页面了!",extra:e.jsx(_,{to:"/",children:e.jsx(E,{type:"primary",children:"返回首页"})})}),G={200:"服务器成功返回请求的数据。",201:"新建或修改数据成功。",202:"一个请求已经进入后台排队（异步任务）。",204:"删除数据成功。",400:"发出的请求有错误，服务器没有进行新建或修改数据的操作。",401:"用户没有权限（令牌、用户名、密码错误）。",403:"用户得到授权，但是访问是被禁止的。",404:"发出的请求针对的是不存在的记录，服务器没有进行操作。",406:"请求的格式不可得。",410:"请求的资源被永久删除，且不会再得到的。",422:"当创建一个对象时，发生一个验证错误。",500:"服务器发生错误，请检查服务器。",502:"网关错误。",503:"服务不可用，服务器暂时过载或维护。",504:"网关超时。"},U=t=>{if(t.request.options.responseType==="blob")return t;const{response:r}=t;if(r&&r.status){const a=G[r.status]||r.statusText,{status:n,url:s}=r;let o=s;s.indexOf("?")!==-1&&(o=s.substring(0,s.indexOf("?"))),p.error(`请求错误 [${n}]: ${o}${a}`)}else r||p.error("您的网络发生异常，无法连接服务器");return r},m=D({errorHandler:U,credentials:"include"});m.interceptors.response.use(async(t,r)=>{if(r.responseType==="blob")return t;const{status:a}=t;return a===500&&p.error({content:"网络错误"}),t});const V=async t=>await new Promise(r=>{setTimeout(()=>{r(!0)},t)}),k=t=>{if(t){const r=(t==null?void 0:t.split(/\ /g))||[0,"KB"];return e.jsx(F,{end:r[0],suffix:r[1],separator:",",decimals:2})}return"0KB"},J=()=>{var h;const[t,r]=l.useState(),[a,n]=l.useState(1920),[s,o]=l.useState([]),c=async()=>{const i=await m.get("/api/system_status");i.code===1e3&&r(i.data)};l.useEffect(()=>{c()},[]);const v=(h=s==null?void 0:s[0])==null?void 0:h.rx,b=[{title:"日期",dataIndex:"day"},{title:"下载",dataIndex:"rx"},{title:"平均速率",tooltip:"下载速率统计可能不准确，仅供参考",dataIndex:"avg"}],C=s==null?void 0:s.reduce((i,P)=>{var j;return i+Number((j=P.rx.match(/\d+\.\d+/g))==null?void 0:j[0])},0);return e.jsx("div",{children:e.jsx(z,{onResize:i=>{n(i.width)},children:e.jsxs(u,{title:"数据概览",extra:e.jsx(e.Fragment,{children:y().format("YYYY-MM-DD HH:mm:ss")}),split:a<1280?"horizontal":"vertical",headerBordered:!0,bordered:!0,children:[e.jsxs(u,{split:"horizontal",children:[e.jsxs(u,{split:"horizontal",children:[e.jsxs(u,{split:a<596?"horizontal":"vertical",children:[e.jsx(d,{statistic:{title:"今日下载",value:v,precision:3,formatter:k}}),e.jsx(d,{statistic:{title:"近30日流量",value:C,suffix:"GB",precision:2}})]}),e.jsxs(u,{split:"vertical",children:[e.jsx(d,{statistic:{title:"内存占用",value:(t==null?void 0:t.memory_used_percent)||0,precision:2,suffix:"%"}}),e.jsx(d,{statistic:{title:"CPU占用",value:`${(t==null?void 0:t.cpu_percent)||0}`,suffix:"%",precision:2}})]})]}),e.jsx(L,{toolbar:{title:"近日流量"},options:a>596?!1:{density:!0,fullScreen:!0,reload:!0},tooltip:"数据更新有延迟，仅供参考",request:async()=>{const i=await m.get("/api/month_info");return i.code===1e3?(o(i.data),{data:i.data,success:!0}):{data:[],success:!1}},search:!1,columns:b,pagination:{hideOnSinglePage:!0}})]}),e.jsx(Q,{})]})},"resize-observer")})},Q=()=>e.jsx(d,{title:"流量走势",extra:!1,chart:e.jsx(W,{})}),W=()=>{const[t,r]=l.useState([]);l.useEffect(()=>{const n=async()=>{const s=await m.get("/api/network_speed");s.code===1e3&&(r(o=>[...o,{label:y().format("HH:mm:ss"),value:Number(s.data)}]),await V(2e3),n())};n()},[]);const a={data:t||[],xField:"label",yField:"value",yAxis:{label:{formatter:n=>`${n}MB`}},tooltip:{title:"下载速度",formatter:n=>({name:n.label,value:n.value})},color:["#1979C9","#D62A0D","#FAA219"],smooth:!0,animation:!1};return e.jsx($,{...a})};function X({to:t}){let r=N();return l.useEffect(()=>{r(t)}),null}const Z=t=>e.jsx(l.Suspense,{children:t});function ee(){return l.useEffect(()=>{var t;(t=document.querySelector("#index-loading"))==null||t.remove()},[]),e.jsx(M,{children:e.jsxs(f,{path:"/",element:e.jsx(Y,{}),children:[e.jsx(f,{path:"NotFound",element:e.jsx(K,{})}),e.jsx(f,{index:!0,element:Z(e.jsx(J,{}))}),e.jsx(f,{path:"*",element:e.jsx(X,{to:"NotFound"})})]})})}x.createRoot(document.getElementById("root")).render(e.jsx(A,{children:e.jsx(ee,{})}));
