import{j as e,P as R,a as T,b as S,c as p,S as f,d as B,M as F,W as v,e as O,f as b}from"./ant-design-pro-components.js";import{az as L,r as d,C as M,s as z,B as A,V as m,aC as E,j as C}from"./antd.js";import{l as N}from"./icons.js";import{O as D,f as H,g as x,a as I}from"./react-router.js";import{L as $,H as q}from"./react-router-dom.js";import{e as G}from"./umi-request.js";import{_ as V}from"./react-countup.js";import{L as Y}from"./ant-charts.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))n(t);new MutationObserver(t=>{for(const o of t)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&n(i)}).observe(document,{childList:!0,subtree:!0});function a(t){const o={};return t.integrity&&(o.integrity=t.integrity),t.referrerPolicy&&(o.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?o.credentials="include":t.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(t){if(t.ep)return;t.ep=!0;const o=a(t);fetch(t.href,o)}})();var j={},w=L;j.createRoot=w.createRoot,j.hydrateRoot=w.hydrateRoot;const K={route:{path:"/",routes:[{path:"/home",name:"欢迎",icon:e.jsx(N,{}),component:"./home"}]},location:{pathname:"/"}},W=()=>{const[r,s]=d.useState("/home");return typeof document>"u"?e.jsx("div",{}):e.jsx("div",{id:"test-pro-layout",style:{height:"100vh",overflow:"auto"},children:e.jsx(R,{hashed:!1,children:e.jsx(M,{getTargetContainer:()=>document.getElementById("test-pro-layout")||document.body,children:e.jsx(T,{prefixCls:"my-prefix",...K,location:{pathname:r},token:{header:{colorBgMenuItemSelected:"rgba(0,0,0,0.04)"}},siderMenuType:"group",menu:{collapsedShowGroupTitle:!0},title:"系统信息",menuItemRender:(a,n)=>e.jsx("div",{onClick:()=>{s(a.path||"/home")},children:n}),children:e.jsx(S,{token:{paddingInlinePageContainerContent:20},subTitle:"下行盒子拉取查看",children:e.jsx(D,{})})})})})})},U=()=>e.jsx(z,{status:"404",title:"404",subTitle:"哦吼,找不到页面了!",extra:e.jsx($,{to:"/",children:e.jsx(A,{type:"primary",children:"返回首页"})})}),k={200:"服务器成功返回请求的数据。",201:"新建或修改数据成功。",202:"一个请求已经进入后台排队（异步任务）。",204:"删除数据成功。",400:"发出的请求有错误，服务器没有进行新建或修改数据的操作。",401:"用户没有权限（令牌、用户名、密码错误）。",403:"用户得到授权，但是访问是被禁止的。",404:"发出的请求针对的是不存在的记录，服务器没有进行操作。",406:"请求的格式不可得。",410:"请求的资源被永久删除，且不会再得到的。",422:"当创建一个对象时，发生一个验证错误。",500:"服务器发生错误，请检查服务器。",502:"网关错误。",503:"服务不可用，服务器暂时过载或维护。",504:"网关超时。"},J=r=>{if(r.request.options.responseType==="blob")return r;const{response:s}=r;if(s&&s.status){const a=k[s.status]||s.statusText,{status:n,url:t}=s;let o=t;t.indexOf("?")!==-1&&(o=t.substring(0,t.indexOf("?"))),m.error(`请求错误 [${n}]: ${o}${a}`)}else s||m.error("您的网络发生异常，无法连接服务器");return s},u=G({errorHandler:J,credentials:"include"});u.interceptors.response.use(async(r,s)=>{if(s.responseType==="blob")return r;const{status:a}=r;return a===500&&m.error({content:"网络错误"}),r});const Q=async r=>await new Promise(s=>{setTimeout(()=>{s(!0)},r)}),X=({width:r})=>e.jsxs(F,{title:"设置模式",layout:"horizontal",modalProps:{destroyOnClose:!0},labelCol:{span:8},request:async()=>{var a,n,t;const s=await u.get("/api/conf_info/");if(s.code===1e3){const o=(a=s.data)!=null&&a.time?(t=((n=s.data)==null?void 0:n.time).split(","))==null?void 0:t.map(i=>({time:i==null?void 0:i.split("_")})):[{time:["00:00","24:00"]}];return(o==null?void 0:o.length)>0?{...s.data,timers:o}:s.data}return null},width:r,trigger:e.jsx("a",{className:"mx-2",children:" 系统设置 "}),onFinish:async s=>{var t,o,i;const a=s;return((t=a.timers)==null?void 0:t.length)>0&&(a.time=(i=(o=a.timers)==null?void 0:o.map(c=>{var h;return(h=c==null?void 0:c.time)==null?void 0:h.join("_")}))==null?void 0:i.join(",")),(await u.post("/api/update_conf/",{data:a})).code===1e3?(m.success("修改成功, 稍后生效！"),!0):(m.error("修改失败，请稍后再试"),!1)},submitter:{render(s,a){return e.jsx("div",{className:" flex gap-x-2 justify-center w-full ",children:a})}},children:[e.jsx(v,{name:"video_type",label:"下行流量类型",tooltip:"下行基本都是省外业务，只是业务不同",allowClear:!1,options:[{label:"抖音快手视频",value:"data"},{label:"抖音直播",value:"dlive"},{label:"快手直播",value:"klive"}],width:"md"}),e.jsx(O,{name:["video_type"],children:({video_type:s},a)=>{const n=s==="data",t=a.getFieldValue("video_thread"),o=new Array(n?10:20).fill(0).map((i,c)=>({label:c+1+" 个线程",value:c+1}));return console.log(t),n&&t>o.length&&a.setFieldsValue({video_thread:o.length}),e.jsx(v,{name:"video_thread",allowClear:!1,label:`${n?"同时下载线程":"同时直播线程"}`,tooltip:"同时进行几个下载，越多越快",width:"md",options:o})}}),e.jsx(b,{name:"max_flow",label:"当天最大流量",tooltip:"当天下载的最大流量(GB)",allowClear:!1,fieldProps:{addonAfter:"GB/天"},width:"md"}),e.jsx(b,{name:"max_mb",label:"线程最大速度",allowClear:!1,fieldProps:{addonAfter:"MB/秒"},tooltip:"每个线程下载时的最大速度(MB/s)",width:"md"})]}),Z=r=>{if(r){const s=(r==null?void 0:r.split(/\ /g))||[0,"KB"];return e.jsx(V,{end:s[0],suffix:s[1],separator:",",decimals:2})}return"0KB"},ee=()=>{var g;const[r,s]=d.useState(),[a,n]=d.useState(1920),[t,o]=d.useState([]),i=async()=>{const l=await u.get("/api/system_status");l.code===1e3&&s(l.data)};d.useEffect(()=>{i()},[]);const c=(g=t==null?void 0:t[0])==null?void 0:g.rx,h=[{title:"日期",dataIndex:"day"},{title:"下载",dataIndex:"rx"},{title:"平均速率",tooltip:"下载速率统计可能不准确，仅供参考",dataIndex:"avg"}],P=t==null?void 0:t.reduce((l,_)=>{var y;return l+Number((y=_.rx.match(/\d+\.\d+/g))==null?void 0:y[0])},0);return e.jsx("div",{children:e.jsx(E,{onResize:l=>{n(l.width)},children:e.jsxs(p,{title:"数据概览",extra:e.jsxs(e.Fragment,{children:[e.jsx(X,{width:a>1e3?800:"md"}),a>1280&&C().format("YYYY-MM-DD HH:mm:ss")]}),split:a<1280?"horizontal":"vertical",headerBordered:!0,bordered:!0,children:[e.jsxs(p,{split:"horizontal",children:[e.jsxs(p,{split:"horizontal",children:[e.jsxs(p,{split:a<596?"horizontal":"vertical",children:[e.jsx(f,{statistic:{title:"今日下载",value:c,precision:3,formatter:Z}}),e.jsx(f,{statistic:{title:"近30日流量",value:P,suffix:"GB",precision:2}})]}),e.jsxs(p,{split:"vertical",children:[e.jsx(f,{statistic:{title:"内存占用",value:(r==null?void 0:r.memory_used_percent)||0,precision:2,suffix:"%"}}),e.jsx(f,{statistic:{title:"CPU占用",value:`${(r==null?void 0:r.cpu_percent)||0}`,suffix:"%",precision:2}})]})]}),e.jsx(B,{headerTitle:"近30日流量",options:a<596?!1:{density:!0,fullScreen:!0,reload:!0},tooltip:"数据更新有延迟，仅供参考",request:async()=>{const l=await u.get("/api/month_info");return l.code===1e3?(o(l.data),{data:l.data,success:!0}):{data:[],success:!1}},search:!1,columns:h,pagination:{hideOnSinglePage:!0,defaultPageSize:7}})]}),e.jsx(f,{title:"流量走势",extra:!1,chart:e.jsx(te,{})})]})},"resize-observer")})},te=()=>{const[r,s]=d.useState([]);d.useEffect(()=>{const n=async()=>{const t=await u.get("/api/network_speed");t.code===1e3&&(s(o=>[...o,{label:C().format("HH:mm:ss"),value:Number(t.data)}]),await Q(2e3),n())};n()},[]);const a={data:r||[],xField:"label",yField:"value",yAxis:{label:{formatter:n=>`${n}MB`}},tooltip:{title:"下载速度",formatter:n=>({name:n.label,value:n.value})},color:["#1979C9","#D62A0D","#FAA219"],smooth:!0,animation:!1};return e.jsx(Y,{...a})};function se({to:r}){let s=I();return d.useEffect(()=>{s(r)}),null}const re=r=>e.jsx(d.Suspense,{children:r});function oe(){return d.useEffect(()=>{var r;(r=document.querySelector("#index-loading"))==null||r.remove()},[]),e.jsx(H,{children:e.jsxs(x,{path:"/",element:e.jsx(W,{}),children:[e.jsx(x,{path:"NotFound",element:e.jsx(U,{})}),e.jsx(x,{index:!0,element:re(e.jsx(ee,{}))}),e.jsx(x,{path:"*",element:e.jsx(se,{to:"NotFound"})})]})})}j.createRoot(document.getElementById("root")).render(e.jsx(q,{children:e.jsx(oe,{})}));
