import{j as e,P as T,a as _,b as B,c as p,M as S,W as g,d as F,e as v,S as f,f as L}from"./ant-design-pro-components.js";import{az as M,r as l,C as O,s as z,B as E,V as x,aC as N,j as w}from"./antd.js";import{l as A}from"./icons.js";import{O as D,f as H,g as h,a as I}from"./react-router.js";import{L as $,H as q}from"./react-router-dom.js";import{e as G}from"./umi-request.js";import{_ as Y}from"./react-countup.js";import{L as K}from"./ant-charts.js";(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const d of n.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&i(d)}).observe(document,{childList:!0,subtree:!0});function a(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerPolicy&&(n.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?n.credentials="include":s.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function i(s){if(s.ep)return;s.ep=!0;const n=a(s);fetch(s.href,n)}})();var j={},b=M;j.createRoot=b.createRoot,j.hydrateRoot=b.hydrateRoot;const W={route:{path:"/",routes:[{path:"/home",name:"欢迎",icon:e.jsx(A,{}),component:"./home"}]},location:{pathname:"/"}},U=()=>{const[t,r]=l.useState("/home");return typeof document>"u"?e.jsx("div",{}):e.jsx("div",{id:"test-pro-layout",style:{height:"100vh",overflow:"auto"},children:e.jsx(T,{hashed:!1,children:e.jsx(O,{getTargetContainer:()=>document.getElementById("test-pro-layout")||document.body,children:e.jsx(_,{prefixCls:"my-prefix",...W,location:{pathname:t},token:{header:{colorBgMenuItemSelected:"rgba(0,0,0,0.04)"}},siderMenuType:"group",menu:{collapsedShowGroupTitle:!0},title:"系统信息",menuItemRender:(a,i)=>e.jsx("div",{onClick:()=>{r(a.path||"/home")},children:i}),children:e.jsx(B,{token:{paddingInlinePageContainerContent:20},subTitle:"下行盒子拉取查看",children:e.jsx(D,{})})})})})})},k=()=>e.jsx(z,{status:"404",title:"404",subTitle:"哦吼,找不到页面了!",extra:e.jsx($,{to:"/",children:e.jsx(E,{type:"primary",children:"返回首页"})})}),V={200:"服务器成功返回请求的数据。",201:"新建或修改数据成功。",202:"一个请求已经进入后台排队（异步任务）。",204:"删除数据成功。",400:"发出的请求有错误，服务器没有进行新建或修改数据的操作。",401:"用户没有权限（令牌、用户名、密码错误）。",403:"用户得到授权，但是访问是被禁止的。",404:"发出的请求针对的是不存在的记录，服务器没有进行操作。",406:"请求的格式不可得。",410:"请求的资源被永久删除，且不会再得到的。",422:"当创建一个对象时，发生一个验证错误。",500:"服务器发生错误，请检查服务器。",502:"网关错误。",503:"服务不可用，服务器暂时过载或维护。",504:"网关超时。"},J=t=>{if(t.request.options.responseType==="blob")return t;const{response:r}=t;if(r&&r.status){const a=V[r.status]||r.statusText,{status:i,url:s}=r;let n=s;s.indexOf("?")!==-1&&(n=s.substring(0,s.indexOf("?"))),x.error(`请求错误 [${i}]: ${n}${a}`)}else r||x.error("您的网络发生异常，无法连接服务器");return r},c=G({errorHandler:J,credentials:"include"});c.interceptors.response.use(async(t,r)=>{if(r.responseType==="blob")return t;const{status:a}=t;return a===500&&x.error({content:"网络错误"}),t});const Q=async t=>await new Promise(r=>{setTimeout(()=>{r(!0)},t)}),X=t=>{if(t){const r=(t==null?void 0:t.split(/\ /g))||[0,"KB"];return e.jsx(Y,{end:r[0],suffix:r[1],separator:",",decimals:2})}return"0KB"},Z=()=>{var y;const[t,r]=l.useState(),[a,i]=l.useState(1920),[s,n]=l.useState([]),d=async()=>{const o=await c.get("/api/system_status");o.code===1e3&&r(o.data)};l.useEffect(()=>{d()},[]);const P=(y=s==null?void 0:s[0])==null?void 0:y.rx,C=[{title:"日期",dataIndex:"day"},{title:"下载",dataIndex:"rx"},{title:"平均速率",tooltip:"下载速率统计可能不准确，仅供参考",dataIndex:"avg"}],R=s==null?void 0:s.reduce((o,u)=>{var m;return o+Number((m=u.rx.match(/\d+\.\d+/g))==null?void 0:m[0])},0);return e.jsx("div",{children:e.jsx(N,{onResize:o=>{i(o.width)},children:e.jsxs(p,{title:"数据概览",extra:e.jsxs(e.Fragment,{children:[e.jsxs(S,{title:"设置模式",layout:"horizontal",labelCol:{span:8},request:async()=>{const o=await c.get("/api/conf_info/");if(o.code===1e3)return o.data},width:a>1e3?800:"md",trigger:e.jsx("a",{className:"mx-2",children:" 系统设置 "}),onFinish:async o=>{(await c.post("/api/update_conf/",{data:o})).code===1e3?x.success("修改成功, 稍后生效！"):x.error("修改失败，请稍后再试")},submitter:{render(o,u){return e.jsx("div",{className:" flex gap-x-2 justify-center w-full ",children:u})}},children:[e.jsx(g,{name:"video_type",label:"下行流量类型",tooltip:"下行基本都是省外业务，只是业务不同",options:[{label:"抖音快手视频",value:"data"},{label:"抖音直播",value:"dlive"},{label:"快手直播",value:"klive"}],width:a<596?"sm":"md"}),e.jsx(F,{name:["video_type"],children:({video_type:o})=>e.jsx(g,{name:"video_thread",label:`${o==="data"?"同时下载线程":"同时直播线程"}`,tooltip:"同时进行几个下载，越多越快",width:a<596?"sm":"md",options:new Array(o==="data"?6:12).fill(0).map((u,m)=>({label:m+1+" 个线程",value:m+1}))})}),e.jsx(v,{name:"max_flow",label:"当天最大流量(GB)",tooltip:"当天下载的最大流量(GB)",allowClear:!1,width:a<596?"sm":"md"}),e.jsx(v,{name:"max_mb",label:"线程最大速度",addonAfter:"MB/秒",tooltip:"每个线程下载时的最大速度(MB/s)",width:a<596?"sm":"md"})]}),w().format("YYYY-MM-DD HH:mm:ss")]}),split:a<1280?"horizontal":"vertical",headerBordered:!0,bordered:!0,children:[e.jsxs(p,{split:"horizontal",children:[e.jsxs(p,{split:"horizontal",children:[e.jsxs(p,{split:a<596?"horizontal":"vertical",children:[e.jsx(f,{statistic:{title:"今日下载",value:P,precision:3,formatter:X}}),e.jsx(f,{statistic:{title:"近30日流量",value:R,suffix:"GB",precision:2}})]}),e.jsxs(p,{split:"vertical",children:[e.jsx(f,{statistic:{title:"内存占用",value:(t==null?void 0:t.memory_used_percent)||0,precision:2,suffix:"%"}}),e.jsx(f,{statistic:{title:"CPU占用",value:`${(t==null?void 0:t.cpu_percent)||0}`,suffix:"%",precision:2}})]})]}),e.jsx(L,{toolbar:{title:"近日流量"},options:a>596?!1:{density:!0,fullScreen:!0,reload:!0},tooltip:"数据更新有延迟，仅供参考",request:async()=>{const o=await c.get("/api/month_info");return o.code===1e3?(n(o.data),{data:o.data,success:!0}):{data:[],success:!1}},search:!1,columns:C,pagination:{hideOnSinglePage:!0,defaultPageSize:7}})]}),e.jsx(f,{title:"流量走势",extra:!1,chart:e.jsx(ee,{})})]})},"resize-observer")})},ee=()=>{const[t,r]=l.useState([]);l.useEffect(()=>{const i=async()=>{const s=await c.get("/api/network_speed");s.code===1e3&&(r(n=>[...n,{label:w().format("HH:mm:ss"),value:Number(s.data)}]),await Q(2e3),i())};i()},[]);const a={data:t||[],xField:"label",yField:"value",yAxis:{label:{formatter:i=>`${i}MB`}},tooltip:{title:"下载速度",formatter:i=>({name:i.label,value:i.value})},color:["#1979C9","#D62A0D","#FAA219"],smooth:!0,animation:!1};return e.jsx(K,{...a})};function te({to:t}){let r=I();return l.useEffect(()=>{r(t)}),null}const se=t=>e.jsx(l.Suspense,{children:t});function re(){return l.useEffect(()=>{var t;(t=document.querySelector("#index-loading"))==null||t.remove()},[]),e.jsx(H,{children:e.jsxs(h,{path:"/",element:e.jsx(U,{}),children:[e.jsx(h,{path:"NotFound",element:e.jsx(k,{})}),e.jsx(h,{index:!0,element:se(e.jsx(Z,{}))}),e.jsx(h,{path:"*",element:e.jsx(te,{to:"NotFound"})})]})})}j.createRoot(document.getElementById("root")).render(e.jsx(q,{children:e.jsx(re,{})}));
